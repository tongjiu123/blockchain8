2025-07-15 12:23:46,239 - INFO - ====== STARTING SIMULATION ======
2025-07-15 12:23:51,481 - INFO - Connected to Web3. Default account: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
2025-07-15 12:23:51,482 - INFO - Loading dataset from /Users/yangzongyou/Downloads/iccip 2022/code_exp/scripts/../dataset/certificates_data.csv...
2025-07-15 12:23:51,653 - INFO - Dataset loaded with 100000 records.
2025-07-15 12:23:51,656 - INFO - --- Deploying all contracts for experiments ---
2025-07-15 12:23:51,656 - INFO - Deploying Certificate (Exp1-3)...
2025-07-15 12:23:52,234 - INFO - Certificate (Exp1-3) deployed at 0x251EE60741E604e8182a340828631C90d2f419d7. Gas used: 620351
2025-07-15 12:23:52,234 - INFO - Authorizing deployer as an institution for 0x251EE60741E604e8182a340828631C90d2f419d7...
2025-07-15 12:23:52,414 - INFO - Authorization successful.
2025-07-15 12:23:52,414 - INFO - Deploying CertOnChain (Exp4)...
2025-07-15 12:23:52,880 - INFO - CertOnChain (Exp4) deployed at 0x284A4E3E998f60d0aAc62e7495751d4a7698e1c3. Gas used: 780025
2025-07-15 12:23:52,880 - INFO - Authorizing deployer as an institution for 0x284A4E3E998f60d0aAc62e7495751d4a7698e1c3...
2025-07-15 12:23:52,880 - INFO - Skipping institution authorization for on-chain contract 0x284A4E3E998f60d0aAc62e7495751d4a7698e1c3 (owner is default issuer).
2025-07-15 12:23:52,880 - INFO - --- Starting Experiment 1: Baseline Performance & Cost ---
2025-07-15 12:23:52,880 - INFO - Measuring latency for 1000 'issueCertificate' transactions...
2025-07-15 12:24:27,814 - INFO - Latency results saved to exp1_latency.csv
2025-07-15 12:24:27,815 - INFO - Measuring gas cost for core operations...
2025-07-15 12:24:27,843 - INFO - Gas cost results saved to exp1_gas_cost.csv
2025-07-15 12:24:27,843 - INFO - --- Experiment 1 Finished ---
2025-07-15 12:24:27,843 - INFO - Total certificates issued after Exp 1: 1000
2025-07-15 12:24:27,846 - INFO - --- Starting Experiment 2: Throughput & Stress Test ---
2025-07-15 12:24:27,857 - INFO - Testing throughput with concurrency level: 1
2025-07-15 12:25:27,864 - INFO - Level 1: 3916 successful transactions in 60.01s. TPS: 65.26
2025-07-15 12:25:27,868 - INFO - Testing throughput with concurrency level: 10
2025-07-15 12:26:27,877 - INFO - Level 10: 449 successful transactions in 60.01s. TPS: 7.48
2025-07-15 12:26:27,879 - INFO - Testing throughput with concurrency level: 50
2025-07-15 12:27:27,903 - INFO - Level 50: 8 successful transactions in 60.02s. TPS: 0.13
2025-07-15 12:27:27,904 - INFO - Testing throughput with concurrency level: 100
2025-07-15 12:28:28,287 - INFO - Level 100: 4 successful transactions in 60.38s. TPS: 0.07
2025-07-15 12:28:28,289 - INFO - Testing throughput with concurrency level: 200
2025-07-15 12:29:28,311 - INFO - Level 200: 0 successful transactions in 60.02s. TPS: 0.00
2025-07-15 12:29:28,312 - INFO - Testing throughput with concurrency level: 500
2025-07-15 12:30:28,784 - INFO - Level 500: 0 successful transactions in 60.47s. TPS: 0.00
2025-07-15 12:30:28,785 - INFO - Testing throughput with concurrency level: 1000
2025-07-15 12:31:31,921 - INFO - Level 1000: 0 successful transactions in 63.13s. TPS: 0.00
2025-07-15 12:31:32,004 - INFO - Throughput results saved to exp2_throughput.csv
2025-07-15 12:31:32,004 - INFO - --- Experiment 2 Finished ---
2025-07-15 12:31:32,173 - INFO - --- Starting Experiment 3: Scalability Test ---
2025-07-15 12:31:32,173 - INFO - Issuing 9000 new certificates to reach 10000 total records...
2025-07-15 12:31:32,199 - CRITICAL - An unrecoverable error occurred: ("execution reverted: Error: VM Exception while processing transaction: reverted with reason string 'Certificate already exists'", {'message': "Error: VM Exception while processing transaction: reverted with reason string 'Certificate already exists'", 'data': '0x08c379a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001a436572746966696361746520616c726561647920657869737473000000000000'})
Traceback (most recent call last):
  File "/Users/yangzongyou/Downloads/iccip 2022/code_exp/scripts/simulation.py", line 386, in main
    newly_issued = run_experiment_3_scalability(helper, cert_contract_exp1, dataset, initial_records=total_issued_certificates)
  File "/Users/yangzongyou/Downloads/iccip 2022/code_exp/scripts/simulation.py", line 208, in run_experiment_3_scalability
    tx_hash = contract.functions.issueCertificate(Web3.to_bytes(hexstr=cert_hash)).transact()
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/contract/contract.py", line 311, in transact
    return transact_with_contract_function(
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/contract/utils.py", line 265, in transact_with_contract_function
    txn_hash = w3.eth.send_transaction(transact_transaction)
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/eth/eth.py", line 387, in send_transaction
    return self._send_transaction(transaction)
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/module.py", line 112, in caller
    result = w3.manager.request_blocking(
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/manager.py", line 231, in request_blocking
    response = self._make_request(method, params)
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/manager.py", line 163, in _make_request
    return request_func(method, params)
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/middleware/base.py", line 56, in middleware
    return self.response_processor(method, make_request(method, params))
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/middleware/base.py", line 56, in middleware
    return self.response_processor(method, make_request(method, params))
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/middleware/base.py", line 56, in middleware
    return self.response_processor(method, make_request(method, params))
  [Previous line repeated 1 more time]
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/middleware/base.py", line 55, in middleware
    method, params = self.request_processor(method, params)
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/middleware/buffered_gas_estimate.py", line 43, in request_processor
    hex(get_buffered_gas_estimate(cast("Web3", self._w3), transaction)),
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/_utils/transactions.py", line 161, in get_buffered_gas_estimate
    gas_estimate = w3.eth.estimate_gas(gas_estimate_transaction)
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/eth/eth.py", line 317, in estimate_gas
    return self._estimate_gas(transaction, block_identifier, state_override)
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/module.py", line 112, in caller
    result = w3.manager.request_blocking(
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/manager.py", line 232, in request_blocking
    return self.formatted_response(
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/manager.py", line 198, in formatted_response
    validate_rpc_response_and_raise_if_error(
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/_utils/validation.py", line 397, in validate_rpc_response_and_raise_if_error
    response = apply_error_formatters(error_formatters, response)
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/_utils/formatters.py", line 146, in apply_error_formatters
    formatted_resp = pipe(response, error_formatters)
  File "cytoolz/functoolz.pyx", line 685, in cytoolz.functoolz.pipe
  File "cytoolz/functoolz.pyx", line 660, in cytoolz.functoolz.c_pipe
  File "/opt/anaconda3/envs/iccip/lib/python3.10/site-packages/web3/_utils/error_formatters_utils.py", line 159, in raise_contract_logic_error_on_revert
    raise ContractLogicError(f"execution reverted: {message}", data=data)
web3.exceptions.ContractLogicError: ("execution reverted: Error: VM Exception while processing transaction: reverted with reason string 'Certificate already exists'", {'message': "Error: VM Exception while processing transaction: reverted with reason string 'Certificate already exists'", 'data': '0x08c379a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001a436572746966696361746520616c726561647920657869737473000000000000'})
2025-07-15 12:31:32,217 - INFO - ====== SIMULATION FINISHED ======
